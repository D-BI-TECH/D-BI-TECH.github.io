---
layout: post
title:  DAXè¿‘ä¼¼éé‡å¤(å”¯ä¸€)è®¡æ•°
date:   2019-12-20 06:03:50 +0000
image:  06.jpg
tags:   [DAX,SSAS,ç»Ÿè®¡å­¦]
author-name: Phil Seamark
author-image: Phil.jpg
---


<small>[åŸæ–‡](https://dax.tips/2019/12/20/dax-approx-distinct-count/)è¯‘æ³¨ï¼šDavis ZHANG  </small>

----------------------

## ä»‹ç»

åœ¨æœ¬åšå®¢ä¸­ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸ªæœ‰è¶£çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ½œåœ¨åœ°ä¼˜åŒ–åŒ…å«ä¸é‡å¤è®¡æ•°è®¡ç®—è¡Œä¸ºçš„æŠ¥è¡¨çš„è¿è¡Œé€Ÿåº¦ã€‚

æœ¬æ–‡ä¸­æ‰€æè¿°çš„æ–¹æ³•è§£é‡Šäº†å¦‚ä½•å°†è¿‘ä¼¼éé‡å¤è®¡æ•°è®¡ç®—çš„DIYç‰ˆæœ¬æ·»åŠ åˆ°åŸºäºDAXçš„æ¨¡å‹ã€‚è¯¥æ–¹æ³•ç»“åˆäº†é¢„å¤„ç†å’Œä¸€äº›å¾ˆé…·çš„æ•°å­¦æŠ€å·§ï¼Œæä¾›äº†ä¸€ä¸ªè¿‘ä¼¼å‡†ç¡®çš„æ•°å€¼ï¼Œå¹¶å…·æœ‰ï¼ˆç›¸å¯¹DISTINCTCOUNTè€Œè¨€ï¼‰é«˜è¾¾25å€çš„è®¡ç®—é€Ÿåº¦ï¼

ä¸‹è¡¨æ˜¾ç¤ºäº†æˆ‘åœ¨äº”ä¸ªå®Œå…¨ä¸åŒçš„æŸ¥è¯¢ä¸­è®°å½•çš„æ€§èƒ½å¢ç›Šã€‚æœ€æ£’çš„ä¸€æ¬¡æ€§èƒ½æ”¹è¿›æ˜¯å°†ä¸€ä¸ª173ç§’çš„æŸ¥è¯¢ï¼ˆå°†è¿‘3åˆ†é’Ÿï¼ï¼‰é™ä½åˆ°ä»…ä»…7ç§’ã€‚è¿‘ä¼¼å€¼çš„å‡†ç¡®åº¦ä¸åˆ°ä¸€ä¸ªç™¾åˆ†ç‚¹çš„å››åˆ†ä¹‹ä¸€ã€‚

![åŸºäºè¿‘ä¼¼ä¸é‡å¤è®¡æ•°çš„DAXï¼ˆHLLï¼‰ä¸DISTINCTCOUNT](https://img-blog.csdnimg.cn/20191226114250401.png)

è¦å°†æ­¤æŠ€æœ¯åº”ç”¨äºæ¨¡å‹ï¼Œæ‚¨éœ€è¦æ·»åŠ ä¸¤ä¸ªé¢å¤–çš„æ•´æ•°åˆ—ï¼ˆä¸‹é¢å°†æ›´è¯¦ç»†åœ°è§£é‡Šï¼‰ä»¥åŠè¦åŠ é€Ÿçš„æ¯ä¸ªæ ¸å¿ƒåˆ—çš„è®¡ç®—åº¦é‡å€¼ã€‚

## æŒ‘æˆ˜

å¦‚æ‚¨æ‰€çŸ¥ï¼Œæ¶‰åŠéé‡å¤è®¡æ•°è®¡ç®—çš„åº¦é‡å€¼é€šå¸¸æ˜¯æ¨¡å‹ä¸­é€Ÿåº¦æœ€æ…¢ã€æœ€è€—è´¹èµ„æºçš„åº¦é‡å€¼ã€‚åŸå› æ˜¯ç›¸æ¯”å…¶ä»–èšåˆï¼ˆå¦‚SUMã€MAXå’ŒCOUNTç­‰ï¼‰è€Œè¨€ï¼Œå¼•æ“è¿˜éœ€è¦é¢å¤–çš„å·¥ä½œæ¥äº§ç”Ÿä¸€ä¸ªå‡†ç¡®çš„å”¯ä¸€å€¼ã€‚

å¦‚æœä¸€ä¸ªé”€å”®è¡¨æ˜¾ç¤ºä¸€å‘¨å†…æ¯å¤©æœ‰10ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆQTYåˆ—ä¸Šçš„SUMåŒ…å«ä¸€æ¬¡æ‰«æï¼Œå¹¶ä¸”åœ¨ä¸€æ¬¡æ‰«ææœŸé—´åªéœ€è¦å°‘é‡å†…å­˜æ¥å­˜å‚¨å’Œç´¯ç§¯ä¸€ä¸ªå€¼ã€‚COUNTå‡½æ•°ä¸SUMç±»ä¼¼ï¼Œå®ƒåªéœ€è¦å°‘é‡å†…å­˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸€æ¬¡æ‰«ææ“ä½œæ¥è®¡ç®—ã€‚

å¯¹äºå®¢æˆ·IDåˆ—ä¸Šçš„éé‡å¤è®¡æ•°ï¼Œå†…éƒ¨çš„å¤„ç†è¿‡ç¨‹æ˜¯éœ€è¦è·Ÿè¸ªå·²è®¡æ•°çš„å®¢æˆ·ï¼Œä»¥é¿å…é‡å¤è®¡æ•°ã€‚åœ¨è¿è¡Œæ—¶ï¼Œè¯¥è¿›ç¨‹éœ€è¦æ›´å¤šå†…å­˜å’Œé¢å¤–çš„æ•°æ®å¤„ç†ã€‚è¿™ç§å¤åˆå¼çš„è®¡ç®—éšç€å”¯ä¸€å€¼æ•°ç›®çš„å¢åŠ è€Œå¢åŠ ã€‚

åœ¨DAXä¸­ï¼Œæˆ‘ä»¬æœ‰[DISTINCTCOUNT](https://docs.microsoft.com/en-nz/dax/distinctcount-function-dax)å‡½æ•°ï¼Œå®ƒæä¾›100%å‡†ç¡®çš„ç»“æœã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œç²¾ç¡®è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œä¾‹å¦‚è´¢åŠ¡ã€å®¡è®¡ã€åŒ»ç–—ä¿å¥ç­‰ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè®¡ç®—çš„é€Ÿåº¦å¯èƒ½ä¼˜å…ˆäºå…¶ç²¾åº¦ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†è¾ƒå¤§æ•°å€¼æ—¶ã€‚

æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–æŠ€å·§åœ¨DAXä¸­ç¼–å†™ç²¾ç¡®çš„ä¸é‡å¤è®¡æ•°çš„è®¡ç®—ï¼Œè¿™äº›æŠ€å·§åŒ…æ‹¬ç»„åˆå„ç§å‡½æ•°ï¼Œå¦‚SUMXã€SUMMARYã€VALUESæˆ–distinctç­‰ã€‚è¿™äº›éƒ½æ ¹æ®æ•°æ®çš„åŸºæœ¬æ€§è´¨æ‰§è¡Œå¾—æ›´å¥½ï¼ˆæˆ–æ›´å·®ï¼‰ï¼Œä½†ä»å¯èƒ½åœ¨CPUå’Œå†…å­˜ä¸Šè€—è´¹å¤§é‡èµ„æºã€‚

## è¿‘ä¼¼éé‡å¤è®¡æ•°

å¦‚æœæˆ‘åœ¨è°·æ­Œæœç´¢â€œDAX Distinct Countï¼ˆDAXéé‡å¤è®¡æ•°ï¼‰â€ï¼Œæˆ‘å¾ˆå¿«å°±ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœï¼Œå‘Šè¯‰æˆ‘å®ƒå‘ç°äº†å¤§çº¦248000ä¸ªç»“æœï¼ˆåœ¨0.36ç§’å†…ï¼‰ã€‚å¿«é€Ÿå¾—åˆ°è¿™ä¸ªç»“æœå¯¹æˆ‘æ¥è¯´è¿œæ¯”èŠ±10åˆ†é’Ÿæˆ–æ›´é•¿çš„æ—¶é—´è®©å®ƒå¯¹æˆ‘è¯´å®ƒæ­£å¥½æ‰¾åˆ°248123ä¸ªç»“æœæœ‰ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ248000è¿™ä¸ªè¿‘ä¼¼æ•°å€¼å·²ç»è¶³å¤Ÿäº†ã€‚

è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æŠ¥è¡¨ä½¿ç”¨åœºæ™¯ã€‚æ‚¨å¯èƒ½å¸Œæœ›åœ¨è¿›è¡Œå”¯ä¸€å€¼è®¡æ•°çš„è®¡ç®—æ—¶æ›´å¿«åœ°å¾—åˆ°æŸ¥è¯¢ç»“æœï¼Œå¹¶ä¸”åªè¦ç»“æœè¶³å¤Ÿæ¥è¿‘ï¼ˆæ¯”å¦‚è¯´+/-2%ï¼‰ï¼Œå°±å¯ä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚

åœ¨2018å¹´12æœˆï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°çš„DAXå‡½æ•°ï¼Œåä¸º[APPROXIMATEDDISTICNTCOUNT](https://docs.microsoft.com/en-nz/dax/approximate-distinctcount-function-dax)ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒä¸ä¼šè¿”å›ç²¾ç¡®çš„ç»“æœï¼›ç›¸åï¼Œå®ƒéœ€è¦ä¸€äº›æ•°å­¦æŠ€å·§ï¼Œæ‰èƒ½æ¶ˆè€—æ›´å°‘çš„CPUå’Œå†…å­˜ä»è€Œæ›´å¿«åœ°è¿”å›è®¡ç®—ç»“æœã€‚

APPROXIMATEDDISTICNTCOUNTå‡½æ•°ä»…åœ¨é€šè¿‡Azure SQLæ•°æ®åº“æˆ–Azure SQLæ•°æ®ä»“åº“ä½œä¸ºæºçš„æŠ¥è¡¨çš„Direct Queryæ¨¡å¼ä¸‹å·¥ä½œã€‚è¯¥å‡½æ•°æ— æ³•è¢«è°ƒæ•´æˆ–ç®€å•åœ°ä½¿ç”¨TSQLä¸­çš„[APPROX_COUNT_DISTINCT](https://docs.microsoft.com/en-us/sql/t-sql/functions/approx-count-distinct-transact-sql?view=sql-server-ver15)å‡½æ•°ã€‚

å¦‚æœå·²ç»å¯¹å…¶ä¸­ä¸€ä¸ªæ•°æ®æºä½¿ç”¨Direct Queryï¼Œåˆ™æ­¤DAXå‡½æ•°å¯ä»¥å·¥ä½œã€‚å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘è¿˜æ˜¯æƒ³çœ‹çœ‹èƒ½å¦åœ¨æ•°æ®æ¨¡å‹ä¸­å¤åˆ¶è¿™ä¸ªå‡½æ•°â€”â€”æ‰€ä»¥åœ¨DAXä¸­æ„å»ºäº†ä¸€ä¸ªDIYç‰ˆæœ¬çš„APPROXIMATEDDISTINCTCOUNTå‡½æ•°ã€‚

## DIY APPROXIMATEDDISTICNTCOUNT

æˆ‘æœ€åˆå¯¹è¯¥æ–¹æ¡ˆçš„ç ”ç©¶ä¸­å¾ˆå¿«è®©æˆ‘æƒ³åˆ°äº†[HyperLogLogï¼ˆHLLï¼‰](https://en.wikipedia.org/wiki/HyperLogLog)ç®—æ³•ï¼Œå®ƒçœ‹èµ·æ¥å°±æ˜¯æˆ‘æ‰€è¿½æ±‚çš„ã€‚HLLèƒŒåçš„æ€æƒ³æ˜¯åœ¨ä¸æ¶ˆè€—å¤§é‡å†…å­˜çš„æƒ…å†µä¸‹ï¼Œå¿«é€Ÿç”Ÿæˆå¤§æ•°æ®é›†ä¸Šçš„åŸºæ•°ä¼°è®¡ã€‚è°·æ­Œã€Facebookå’ŒTwitterç­‰å…¬å¸ä½¿ç”¨HLLç®—æ³•çš„å˜ä½“ï¼Œå¸®åŠ©ä»–ä»¬æ›´æœ‰æ•ˆåœ°è®¡ç®—ã€åˆ†æå’Œç†è§£æµ·é‡æ•°æ®é›†ã€‚

*(è¯‘æ³¨ï¼šHyperLogLogç®—æ³•æºäºä¼¯åŠªåˆ©è¯•éªŒï¼Œå³ä»¥æŠ›ç¡¬å¸ä¸ºä¾‹ï¼Œç”¨è¿ç»­å‡ºç°æ­£/åé¢çš„æ¬¡æ•°æ¥ä¼°è®¡æ­¤è¯•éªŒä¸€å…±æ‰”äº†å¤šå°‘æ¬¡ï¼Œè¯¯å·®éšè¯•éªŒæ¬¡æ•°çš„å¢åŠ è€Œé™ä½ï¼Œè¿™é‡Œä½¿ç”¨äº†åˆ†æ¡¶çš„æ€æƒ³ï¼Œå°†ç»Ÿè®¡æ•°æ®åˆ’åˆ†ä¸ºå¤šä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶åˆ†åˆ«è¿›è¡Œä¼°è®¡ï¼Œæ¯”å¦‚ç¡¬å¸è¿ç»­å‡ºç°æ­£/åé¢çš„æ¬¡æ•°ï¼Œæœ€åå–æ‰€æœ‰æ¡¶ä¼°è®¡å€¼çš„ç®—æœ¯å¹³å‡æ•°ä½œä¸ºæœ€ç»ˆç»“æœï¼Œæ­¤å³ä¸ºLogLogç®—æ³•ï¼Œä½†è¯¥ç®—æ³•å­˜åœ¨ç¼ºé™·ï¼Œæ¯”å¦‚å®¹æ˜“å—æå€¼çš„å½±å“ï¼Œå› æ­¤å°†åŸæœ¬çš„ç®—æœ¯å¹³å‡è®¡ç®—æ³•æ”¹æˆäº†è°ƒå’Œå¹³å‡è®¡ç®—æ³•ï¼Œæ˜¾è‘—æé«˜äº†ä¼°è®¡ç»“æœçš„å¯é æ€§ï¼Œæ­¤å³HyperLogLog)*

å…³äºè¿™ä¸ªä¸»é¢˜æœ‰å¾ˆå¤šæœ‰ç”¨çš„åšå®¢æ–‡ç« ï¼Œå¸®åŠ©æˆ‘æ…¢æ…¢ç†è§£ç®—æ³•çš„å·¥ä½œåŸç†ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥æ‰¾åˆ°ä¸€ç§åœ¨DAXä¸­å®ç°å®ƒçš„æ–¹æ³•ã€‚æœ‰äº›æ–‡ç« åªå…³æ³¨ç†è®ºï¼Œè€Œå¦ä¸€äº›æ–‡ç« åˆ™ç”¨å„ç§ç¼–ç¨‹è¯­è¨€æä¾›åŸºäºä»£ç çš„å®ç”¨è§£å†³æ–¹æ¡ˆã€‚

æˆ‘åœ¨åšå®¢åº•éƒ¨é™„ä¸Šäº†æˆ‘æ‰€æ‰¾åˆ°çš„å®Œæ•´æ–‡ç« åˆ—è¡¨ï¼Œä½†å¯¹æˆ‘æ¥è¯´æœ€æœ‰ç”¨çš„æ–‡ç« é“¾æ¥æ˜¯ï¼š

[http://static.googleusercontent.com/media/research.google.com/en/us/pubs/archive/40671.pdf](http://static.googleusercontent.com/media/research.google.com/en/us/pubs/archive/40671.pdf)

HLLçš„æ€æƒ³æ˜¯ï¼Œé¦–å…ˆåœ¨å”¯ä¸€å€¼è®¡æ•°è®¡ç®—ä¸­ä¸ºæ¯ä¸ªé¡¹åˆ›å»ºä¸€ä¸ªæ•£åˆ—å€¼ã€‚å“ˆå¸Œå€¼é€šå¸¸ç”¨äºåŠ å¯†/è§£å¯†ã€‚ç„¶è€Œï¼Œå¯¹äºHLLï¼Œæ•£åˆ—é¡¹çš„ä¸»è¦ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ä¸ªè¾“å‡ºå€¼ï¼Œè¯¥è¾“å‡ºå€¼å¯¹äºæ¯ä¸ªè¾“å…¥å€¼å…·æœ‰ç›¸åŒçš„ä½æ•°ã€‚

|Text Value | Hash Value |
|--|--|
| DAX | 4172989e6bf5b674bd2a7a6dc770790b |
| Approximate | b81a30c12698563b79179ec37d43629 |
| DAX is Fun | de54835215117a88ba9e66967015f007 |
| 1 | c4ca4238a0b923820dcc509a6f75849b |
| 2 | c81e728d9d4c2f636f067f89cc14862c |
| 3 | eccbc87e4b5ce2fe28308fd9f2a7baf3 |


å¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œæ¯ä¸ªæ–‡æœ¬å€¼çš„å“ˆå¸Œç‰ˆæœ¬æ€»æ˜¯ç›¸åŒçš„é•¿åº¦ã€‚ç±»ä¼¼çš„å€¼ï¼ˆå¦‚1ã€2å’Œ3ï¼‰ä¼šäº§ç”Ÿå®Œå…¨ä¸åŒçš„æ•£åˆ—ç»“æœã€‚å…¶ä»–ç®—æ³•å¯ä»¥ç”¨æ¥ä»£æ›¿MD5ï¼Œå¦‚SHA1ã€SHA256æˆ–murdur3ã€‚å¯¹äºç”¨äºHLLçš„æ•£åˆ—ç®—æ³•ï¼Œæœ€é‡è¦çš„ç‰¹æ€§æ˜¯ç®—æ³•æ€»æ˜¯ä¸ºç»™å®šçš„è¾“å…¥ç”Ÿæˆç›¸åŒçš„è¾“å‡ºï¼Œå¹¶ä¸”å¯¹äºæ‰€æœ‰çš„è¾“å…¥å€¼ï¼Œè¾“å‡ºçš„é•¿åº¦æ€»æ˜¯ç›¸åŒçš„ï¼Œè€Œä¸ç®¡è¾“å…¥å€¼çš„é•¿åº¦å¦‚ä½•ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMD5å“ˆå¸Œç”Ÿæˆçš„32ä¸ªå­—ç¬¦æ˜¯åå…­è¿›åˆ¶å¯¹ï¼Œå¯ä»¥è½¬æ¢ä¸º128ä½é•¿çš„äºŒè¿›åˆ¶æ•°ã€‚

ç„¶åï¼ŒHLLè¿›ç¨‹å¯ä»¥ä½¿ç”¨ä½å­—ç¬¦ä¸²ï¼ˆ1å’Œ0ï¼‰æ¥åŠ©å…¶æ‰§è¡Œã€‚

ä¸€æ—¦æˆ‘ä»¬æœ‰äº†æ•£åˆ—å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»æ¯ä¸ªé›†åˆä¸­æå–å‡ºä¸¤ä¸ªé‡è¦çš„å€¼ï¼š

- HLLæ¡¶
- ä»äºŒè¿›åˆ¶å­—ç¬¦ä¸²çš„ä¸€è‡´ç‚¹å¼€å§‹è®¡ç®—è¿ç»­é›¶çš„ä¸ªæ•°

![ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¾ç¤ºäº†15ä¸ªé¡¹ï¼ˆæ¯é¡¹1è¡Œï¼‰ä¸ºæ¡¶å’Œ0æ´¾ç”Ÿæ•´æ•°å€¼](https://img-blog.csdnimg.cn/20191226114309837.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)

ä¸Šå›¾æ˜¾ç¤ºäº†ä¸€ä¸ªäºŒè¿›åˆ¶å€¼å—ï¼Œå…¶ä¸­æ¯ä¸€è¡Œè¡¨ç¤ºåœ¨ä¸åŒè®¡æ•°è®¡ç®—ä¸­å¤„ç†çš„é¡¹ã€‚åŸå§‹å€¼ä½¿ç”¨MD5è½¬æ¢ä¸ºæ•£åˆ—å€¼ï¼Œå›¾åƒæ˜¾ç¤ºäºŒè¿›åˆ¶è¡¨ç¤ºçš„ä¸€éƒ¨åˆ†ã€‚é€šå¸¸ï¼Œè¿™å°†æ˜¯128ä½é•¿ï¼Œä½†è¿™å¼ å›¾ç‰‡åªæ˜¾ç¤ºäº†ä¸€éƒ¨åˆ†ã€‚

è™šçº¿å‚ç›´æ”¾ç½®åœ¨æ‰€æœ‰å€¼ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå¤§æ¦‚ä½äºä¸­é—´ã€‚çº¢çº¿å·¦ä¾§çš„ä¸‰åˆ—ç”¨äºå°†æ¯ä¸ªå€¼åˆ†ç±»åˆ°å“ˆå¸Œæ¡¶ä¸­ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæœ¬ä¾‹ä»…ä½¿ç”¨ä¸‰åˆ—ï¼Œæœ€å¤šå…è®¸8ä¸ªå­˜å‚¨æ¡¶ã€‚åœ¨æœ¬ä¾‹ä¸­çš„15ä¸ªé¡¹ä¸­ï¼Œ1ä¸ªé¡¹åœ¨Bucket-0ä¸­ï¼Œ1ä¸ªé¡¹åœ¨Bucket-1ä¸­ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°Bucket-7ï¼ˆå®ƒæœ‰4ä¸ªé¡¹ï¼‰ã€‚

äºŒè¿›åˆ¶Bucketå€¼å°†è½¬æ¢å›åè¿›åˆ¶ï¼Œå¹¶æ˜¾ç¤ºåœ¨Bucketæ ‡é¢˜ä¸‹çš„å³ä¾§åˆ—ä¸­ã€‚åœ¨ç¬¬ä¸€è¡Œä¸­ï¼Œ111å€¼è½¬æ¢ä¸ºBucket-7ï¼Œè€Œåœ¨ç¬¬äºŒè¡Œä¸­ï¼Œ000å€¼è½¬æ¢ä¸ºBucket-0ã€‚ä½¿ç”¨è¿™ç§æŠ€æœ¯ï¼Œæ‰€æœ‰è¡Œéƒ½è¢«åˆ†é…åˆ°8ä¸ªBucketï¼ˆæ¡¶ï¼‰ä¸­çš„ä¸€ä¸ªã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20191226114312531.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)

å¯¹äºæ¯è¡Œè€Œè¨€ï¼Œå¦‚ä½•ç¡®å®šæ˜¯å“ªä¸ªæ¡¶è¢«åˆ†é…åˆ°æ”¹è¡Œï¼Ÿé¡¶éƒ¨çš„é¡¹ä½äºBucket-7ã€‚

*ï¼ˆè¯‘æ³¨ï¼šæ ¹æ®çº¢çº¿å·¦ä¾§ä¸‰åˆ—å€¼è½¬æ¢ä¸º10è¿›åˆ¶å¾—å‡ºï¼‰*

å¯¹äºä¸‹ä¸€éƒ¨åˆ†çš„è®¡ç®—ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªä¸€è‡´ç‚¹å¼€å§‹è®¡ç®—è¿ç»­é›¶çš„æ•°é‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‚ç›´çº¢çº¿å³ä¾§çš„ä½æ•°è¢«ä½¿ç”¨äº†ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20191226114325183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)

å¦‚ä½•ç¡®å®šZerosåˆ—çš„å€¼ï¼Ÿé¡¶éƒ¨é¡¹æœ‰5ä¸ªè¿ç»­çš„å€¼ï¼Œå› æ­¤åœ¨â€œZerosâ€åˆ—ä¸­çš„å€¼æ˜¯5
æœ€ä¸Šé¢çš„ä¸€è¡Œåœ¨çº¢çº¿çš„å³è¾¹æœ‰5ä¸ªè¿ç»­çš„0ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ºè¿™ä¸€è¡Œå­˜å‚¨çš„å€¼æ˜¯5ã€‚

ä¸€æ—¦ä»äºŒè¿›åˆ¶æ•°æ®ä¸­æå–å‡ºæ‰€æœ‰æ¡¶å’Œ0å€¼ï¼ŒHLLè¿›ç¨‹å°±å¯ä»¥èšåˆç”Ÿæˆä¸€ä¸ªè¡¨ï¼Œæ¯ä¸ªæ¡¶åªæœ‰ä¸€è¡Œï¼ŒåŒæ—¶"MAX Zeros"åˆ—æ˜¾ç¤ºæœ€å¤§è¿ç»­é›¶çš„æ•°é‡:

![æ¯æ¡¶ä¸€è¡Œçš„èšåˆè¡¨ï¼Œä»¥åŠæ¥è‡ªZerosåˆ—çš„æœ€å¤§å€¼](https://img-blog.csdnimg.cn/20191226114332262.png)

ä¸Šé¢çš„å›¾åƒè¡¨æ˜ï¼Œå¯¹äºæ‰€æœ‰å‘ç”Ÿåœ¨Bucket-7ä¸­çš„è¡Œï¼Œè¿ç»­é›¶ç‚¹çš„æœ€å¤§æ•°ç›®æ˜¯5ï¼Œè€Œå¯¹äºBucket-5ï¼Œå¯¹åº”å€¼æ˜¯3ã€‚

HLLè®¡ç®—çš„æœ€åä¸€éƒ¨åˆ†æ˜¯å°†MAX Zeroåˆ—ä¸­çš„å€¼ä¹˜ä»¥2çš„å¹‚ï¼Œç„¶åå¯¹ç»“æœè¿›è¡Œå¹³å‡ã€‚

![HLLé€šè¿‡å¯¹MAX Zerosæ•°æ®åº”ç”¨å¹³å‡å€¼ä¼°è®¡å‡º7ä¸ªå”¯ä¸€å€¼](https://img-blog.csdnimg.cn/20191226114334824.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)

åœ¨ä¸Šé¢çš„å›¾åƒä¸­ï¼Œå·¦è¾¹çš„è¡¨æ¯æ¡¶æœ‰1è¡Œï¼Œå®ƒåŒ…å«æ¯æ¡¶çš„è¿ç»­é›¶ç‚¹çš„æœ€å¤§æ•°ç›®ã€‚å³è¾¹çš„è¡¨æ ¼æ˜¾ç¤ºäº†2æ¬¡æ–¹çš„æœ€å¤§é›¶å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¡ç®—è¿™äº›å€¼çš„å¹³å‡å€¼ï¼ˆå¾—å‡º7ï¼‰ä½œä¸ºæˆ‘ä»¬çš„ä¼°è®¡å€¼ã€‚

#### è°ƒæ•´ä¼˜åŒ–

è¿™ä¸ªä¾‹å­è¢«è®¾è®¡å¾—è¿‡äºç®€å•ï¼Œä»¥æ¼”ç¤ºHLLçš„æ–¹æ³•ï¼Œç»“æœå¯èƒ½ä¸åœ¨æ­£è´Ÿ2%èŒƒå›´ä¹‹å†…ã€‚å®é™…æƒ…å†µæ˜¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡é€‰æ‹©æ›´å¤šçš„æ¯”ç‰¹ï¼ˆä¹Ÿç›¸å½“äºé€‰æ‹©æ›´å¤šçš„æ¡¶ï¼‰ä»¥åŠç”¨äºæ‰§è¡Œå¹³å‡å€¼çš„æŠ€æœ¯æ¥ä¼˜åŒ–ç®—æ³•ã€‚

åœ¨å®è·µæ–‡ä»¶ä¸­ï¼Œ[HyperLogLogä¸­æè¿°çš„ä¾‹å­](http://static.googleusercontent.com/media/research.google.com/en/us/pubs/archive/40671.pdf)ä½¿ç”¨äº†14æ¯”ç‰¹ï¼Œç»“æœæ˜¯16384ä¸ªæ¡¶ï¼ˆ214=16384ï¼‰ï¼Œå¬èµ·æ¥å¯èƒ½å¾ˆå¤šï¼Œä½†æ˜¯å¦‚æœæœ‰æ•°ç™¾ä¸‡è¡Œè¦å¤„ç†ï¼Œå®ƒå°±å¼€å§‹å˜å¾—æ›´æœ‰æ„ä¹‰äº†ã€‚æ›´å¤šçš„æ¯”ç‰¹å°†ä»¥ç‰ºç‰²ä¸€å®šçš„æ€§èƒ½ä¸ºä»£ä»·æ¢å–æ›´å¥½çš„è®¡ç®—ç²¾åº¦ã€‚

ä¼˜åŒ–ç®—æ³•çš„å…¶ä»–æ–¹å¼æ˜¯è°ƒæ•´æ‰§è¡Œæœ€ç»ˆå¹³å‡å€¼çš„è®¡ç®—ã€‚ä¸€äº›è®ºæ–‡å»ºè®®ä¸¢å¼ƒé«˜/ä½å¼‚å¸¸å€¼çš„ç™¾åˆ†æ¯”ï¼Œä»¥æé«˜å‡†ç¡®æ€§ï¼ŒåŒæ—¶å¯¹è¾ƒä½çš„åŸºæ•°å€¼åº”ç”¨åç§»é‡ã€‚å…¶ä»–é€‰æ‹©åŒ…æ‹¬ä½¿ç”¨æœ€ç»ˆå¹³å‡æ•°çš„å˜åŒ–ï¼Œä¾‹å¦‚ä½¿ç”¨[â€œè°ƒå’Œå¹³å‡æ•°â€](http://static.googleusercontent.com/media/research.google.com/en/us/pubs/archive/40671.pdf)ä»£æ›¿æ›´æ ‡å‡†çš„å¹³å‡æ•°ã€‚å¦ä¸€ä¸ªæ”¹è¿›æ˜¯ä½œä¸ºè®¡ç®—çš„ä¸€éƒ¨åˆ†åº”ç”¨ä¸€ä¸ªåå€šã€‚åƒè¿™æ ·çš„è°ƒæ•´éœ€è¦ç»è¿‡æµ‹è¯•ï¼Œä»¥ä¾¿åœ¨æé«˜å‡†ç¡®æ€§å’Œé™ä½æŸ¥è¯¢é€Ÿåº¦ä¹‹é—´æ‰¾åˆ°æ­£ç¡®çš„å¹³è¡¡ã€‚

è¿™é‡Œçš„è¦ç‚¹æ˜¯ï¼Œä¸ç›´æ¥ä½¿ç”¨ç±»ä¼¼äº[APPROXIMATEDDISTCINTCOUNT](https://docs.microsoft.com/en-nz/dax/approximate-distinctcount-function-dax)å‡½æ•°çš„æ–¹å¼ç›¸æ¯”ï¼Œæ‚¨è‡ªå·±æ„å»ºç®—æ³•æœ‰åŠæ³•å¯¹å…¶è¿›è¡Œä¼˜åŒ–ã€‚

## å®ç°

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†HLLçš„å·¥ä½œåŸç†ï¼›ä¸‹ä¸€èŠ‚å°†å±•ç¤ºä¸€ç§åœ¨DAXæ¨¡å‹ä¸­å®ç°HLLçš„æ–¹æ³•ã€‚æˆ‘æå‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ç®€å•åœ°ä¸ºæ¯ä¸ªåˆ—æ·»åŠ ä¸¤ä¸ªæ•´æ•°åˆ—ï¼Œå¸Œæœ›ç”Ÿæˆä¸€ä¸ªè¿‘ä¼¼å”¯ä¸€å€¼è®¡æ•°ã€‚å­˜å‚¨åœ¨è¿™ä¸¤åˆ—ä¸­çš„å€¼éœ€è¦é¢„å…ˆè®¡ç®—ã€‚ä¸€æ—¦ç›®æ ‡åˆ—è¢«è¯†åˆ«ï¼ˆæ¯”å¦‚UserIDï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªæ•£åˆ—å€¼ï¼Œç„¶åä»ä¸€è‡´ç‚¹æå–Bucketå€¼å’Œè¿ç»­é›¶çš„æ•°é‡ã€‚æ•£åˆ—å€¼å¯ä»¥è¢«ä¸¢å¼ƒï¼Œåªæœ‰ä¸¤ä¸ªæ•´æ•°å€¼å­˜å‚¨åœ¨æœ€åä¸€ä¸ªè¡¨ä¸­ã€‚

å¯ä»¥åœ¨åŠ è½½æ•°æ®çš„åŒæ—¶ç”Ÿæˆæ•£åˆ—ï¼Œç„¶åæå–è¿™ä¸¤ä¸ªæ•´æ•°å€¼-æ— è®ºæ˜¯åœ¨PQè¿˜æ˜¯TSQLä¸­ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å®ƒä»¬ä¸æ˜¯åŠ¨æ€çš„ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯é¢„å…ˆè®¡ç®—å¹¶å°†è¿™äº›å€¼å­˜å‚¨åœ¨æºè¡¨ä¸­ã€‚æ ¹æ®Bucketåˆ—ä½¿ç”¨äº†å¤šå°‘ä½ï¼ˆç”¨äºæ§åˆ¶ç²¾åº¦ï¼‰ï¼Œæ‚¨å°†åªå­˜å‚¨ä¸€ä¸ª0åˆ°16384ä¹‹é—´çš„æ•°å­—ï¼Œè€ŒMAX Zeroåˆ—åªæœ‰ä¸€ä¸ª0åˆ°30ï¼ˆå¯èƒ½å°äºï¼‰çš„æ•´æ•°ã€‚è¿™äº›å°çš„æ•´æ•°å€¼ä¸åŸºäºåˆ—å¼•æ“çš„å­˜å‚¨èƒ½å¤Ÿå¾ˆå¥½åœ°é…åˆã€‚

ä¸‹é¢çš„TSQLç¤ºä¾‹åœ¨ä¸€ä¸ªUserIDåˆ—ä¸Šç”Ÿæˆä¸¤ä¸ªå¿…éœ€çš„åˆ—ã€‚TSQLç¤ºä¾‹çš„ç»“æ„ä½¿ç”¨ä¸€ä¸ªå†…éƒ¨æ´¾ç”Ÿè¡¨ï¼Œè¯¥è¡¨è°ƒç”¨TSQL MD5å‡½æ•°å°†æ¯ä¸ªç”¨æˆ·idè½¬æ¢ä¸ºå“ˆå¸Œçš„åå…­è¿›åˆ¶è¡¨ç¤ºã€‚å¤–éƒ¨SELECTè¯­å¥è§£æmd5åˆ—ä»¥æå–å“ˆå¸Œæ¡¶ï¼ˆHLL_hash bucketï¼‰å’Œè¿ç»­é›¶çš„è®¡æ•°ï¼ˆHLL_FirstZeroï¼‰ã€‚æ³¨æ„ï¼ŒMD5å€¼ä¸ä¼šåœ¨æœ€ç»ˆçš„é€‰æ‹©è¯­å¥ä¸­ç»“æŸã€‚

>```SQL
CREATE TABLE [fact].[MyEvents]
WITH
(
    DISTRIBUTION = HASH ( [DateKey] ),
    CLUSTERED COLUMNSTORE INDEX
)
AS
    SELECT 
        [DateKey] ,
        [UserID] ,
        [DeviceID] ,
        [OperatingSystemID],
        [OperatingSystemVersionID],
        [GeographyID] ,
        [Quantity_ThisYear],
        [Quantity_LastYear]  , 
        CONVERT(int,CONVERT(binary(2),'0x' + SUBSTRING(md5,15,4),1)) % POWER(2,14) AS HLL_HashBucket ,
        CHARINDEX('1',
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,19,1),1)) / 8) % 2 AS CHAR(1)) + 
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,19,1),1)) / 4) % 2 AS CHAR(1)) +
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,19,1),1)) / 2) % 2 AS CHAR(1)) +
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,19,1),1)) / 1) % 2 AS CHAR(1)) +
>
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,20,1),1)) / 8) % 2 AS CHAR(1)) + 
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,20,1),1)) / 4) % 2 AS CHAR(1)) +
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,20,1),1)) / 2) % 2 AS CHAR(1)) +
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,20,1),1)) / 1) % 2 AS CHAR(1)) +
>    
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,21,1),1)) / 8) % 2 AS CHAR(1)) + 
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,21,1),1)) / 4) % 2 AS CHAR(1)) +
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,21,1),1)) / 2) % 2 AS CHAR(1)) +
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,21,1),1)) / 1) % 2 AS CHAR(1)) +
>    
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,22,1),1)) / 8) % 2 AS CHAR(1)) + 
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,22,1),1)) / 4) % 2 AS CHAR(1)) +
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,22,1),1)) / 2) % 2 AS CHAR(1)) +
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,22,1),1)) / 1) % 2 AS CHAR(1)) +
>        
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,23,1),1)) / 8) % 2 AS CHAR(1)) + 
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,23,1),1)) / 4) % 2 AS CHAR(1)) +
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,23,1),1)) / 2) % 2 AS CHAR(1)) +
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,23,1),1)) / 1) % 2 AS CHAR(1)) +
>        
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,24,1),1)) / 8) % 2 AS CHAR(1)) + 
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,24,1),1)) / 4) % 2 AS CHAR(1)) +
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,24,1),1)) / 2) % 2 AS CHAR(1)) +
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,24,1),1)) / 1) % 2 AS CHAR(1)) +
>        
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,25,1),1)) / 8) % 2 AS CHAR(1)) + 
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,25,1),1)) / 4) % 2 AS CHAR(1)) +
        CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,25,1),1)) / 2) % 2 AS CHAR(1)) +
>       CAST((CONVERT(int,CONVERT(binary(1),'0x0' + SUBSTRING(md5,25,1),1)) / 1) % 2 AS CHAR(1)) +
>    
>       '') -1 AS HLL_FirstZero  
    FROM(
        SELECT  
        * ,  
        CONVERT(VARCHAR(50),HASHBYTES('MD5',cast(UserID as VarChar)),1) as MD5 
        FROM [fact].[myEvents]
        ) AS A
>```

ä¸€æ—¦å°†ä¸¤ä¸ªHLLè¾…åŠ©åˆ—æ·»åŠ åˆ°äº‹å®è¡¨ä¸­ï¼ŒDIY HLLç®—æ³•çš„å…¶ä½™å…ƒç´ å°±å¯ä»¥é€šè¿‡å‘æ¨¡å‹ä¸­æ·»åŠ è®¡ç®—åº¦é‡å€¼åœ¨DAXä¸­å®ç°

è€ƒè™‘ä¸‹é¢çš„æ•°æ®æ¨¡å‹ä»¥åŠåœ¨MyEvicesè¡¨ä¸­æ·»åŠ USEIDåˆ—çš„è¿‘ä¼¼å”¯ä¸€å€¼è®¡æ•°è®¡ç®—çš„è¦æ±‚ã€‚

åº•å±‚æ•°æ®é›†åœ¨MyEventsè¡¨ä¸­æœ‰500å¤šäº¿è¡Œï¼Œåœ¨ç”¨æˆ·ç»´åº¦ä¸­æœ‰è¿‘2äº¿è¡Œã€‚éœ€æ±‚æ˜¯è·Ÿè¸ªå’Œåˆ†ææ´»åŠ¨ç”¨æˆ·çš„å¤§è‡´æ•°é‡ï¼ŒæŒ‰å¤©æˆ–æœˆ-å¹¶ä¸”æœ‰èƒ½åŠ›é€šè¿‡è®¾å¤‡å’Œ/æˆ–æ“ä½œç³»ç»Ÿè¿›è¡Œåˆ‡ç‰‡ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20191226175820515.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)

ä¸ºäº†ä½¿å®ƒæ­£å¸¸å·¥ä½œï¼Œæˆ‘å°†ä¸¤ä¸ªHLLè¾…åŠ©åˆ—æ·»åŠ åˆ°æ•°æ®æºä¸­çš„MyEventsè¡¨ä¸­ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæ•°æ®æºä½äºAzure SQL DWç¯å¢ƒï¼Œå› æ­¤æˆ‘ä½¿ç”¨äº†å‰æ–‡æ‰€ç¤ºçš„TSQLã€‚

![ä¸¤ä¸ªHLLè¾…åŠ©åˆ—ï¼Œå¦‚å³ä¾§æ‰€ç¤º](https://img-blog.csdnimg.cn/20191226175825589.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)

ç„¶åï¼Œå¯ä»¥å°†ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„DAXè®¡ç®—æ·»åŠ åˆ°æ¨¡å‹ä¸­ã€‚æˆ‘è¯•å›¾å°†å˜é‡åä¸[æ­¤è®ºæ–‡](http://static.googleusercontent.com/media/research.google.com/en/us/pubs/archive/40671.pdf)ç¬¬8é¡µæ‰€ç¤ºä¼ªé€»è¾‘çš„ç¬¬0é˜¶æ®µå’Œç¬¬2é˜¶æ®µçš„é€»è¾‘å¯¹é½ã€‚æœ¬æ–‡çš„ç¬¬1é˜¶æ®µä¸»è¦è®¨è®ºé€šè¿‡æ·»åŠ ä¸¤ä¸ªé¢„è®¡ç®—åˆ—æ¥è¿›è¡Œé€»è¾‘æ±‚è§£ã€‚

>```Python
Approx Distinct Users =
    VAR p = 14  -- Number of bits for bucket     
    VAR m = POWER ( 2, p )         
    VAR Registers = VALUES ( 'MyEvents'[HLL_HashBucket] )     
    VAR CountOfRegisters = COUNTROWS(  Registers )       
    VAR E =
        ( 0.7213 / ( 1 + ( 1.079 / m ) ) )               
        * POWER ( m, 2 )
            * POWER (
                SUMX (
                    Registers,
                    VAR myPower =
                        CALCULATE ( MAX ( 'MyEvents'[HLL_FirstZero] ) ) + 1
                    RETURN
                        POWER ( 2, - myPower )
                ),
                -1
            )        
    RETURN E
>```

ä¸€æ—¦åº¦é‡è¢«æ·»åŠ åˆ°æ¨¡å‹ä¸­ï¼Œå®ƒå°±å¯ä»¥åœ¨è§†è§‰ä¸Šåˆ‡ç‰‡å’Œåˆ‡å‰²ï¼Œä»¥äº§ç”Ÿè¿‘ä¼¼å”¯ä¸€å€¼è®¡æ•°ï¼Œåªè¦ç»“æœé«˜äº100000ï¼Œå°±è¯´æ˜æ•°æ®åœ¨+/- 2%èŒƒå›´å†…å¯ä¿¡ã€‚å¦‚æœè¾“å‡ºå¯èƒ½ä½äºæ­¤å€¼ï¼Œåˆ™å¯ä»¥æ·»åŠ ï¼ˆæˆ–æ›¿æ¢ï¼‰é™„åŠ ä»£ç ï¼Œä»¥æ›¿æ¢ä¸º[çº¿æ€§è®¡æ•°](http://dblab.kaist.ac.kr/Prof/pdf/ACM90_TODS_v15n2.pdf)å’Œ/æˆ–åº”ç”¨åå·®æ ¡æ­£ã€‚

## æµ‹è¯•ç»“æœ

æˆ‘ä»ä¸¤ä¸ªæ–¹é¢å¯¹HLLç®—æ³•è¿›è¡Œæµ‹è¯•ï¼šæŸ¥è¯¢é€Ÿåº¦å’Œç»“æœå‡†ç¡®æ€§ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒçš„æ‰§è¡Œé€Ÿåº¦æ¯”DISTINCTCOUNTå‡½æ•°å¿«å¾—å¤šï¼Œå¹¶ä¸”ä»ç„¶äº§ç”Ÿååˆ†æ¥è¿‘çœŸå®ç»“æœçš„å€¼ã€‚

æˆ‘ä½¿ç”¨çš„æµ‹è¯•ç¯å¢ƒæ˜¯:

- Azure Windows VM. æ ‡å‡†ç‰ˆ B20ms (20 vcpus, 80 GiB å†…å­˜)
- Visual Studio 2017 -- SSAS æœ¬åœ°é¡¹ç›®
- ä½¿ç”¨ä¸¤å¹´çš„é¥æµ‹æ•°æ®å¤„ç†çš„500äº¿è¡Œæ•°æ®é›†
- ä¸Šæ–‡æ‰€ç¤ºçš„æ•°æ®æ¨¡å‹
- 1ä¸ªVisual Studio Analysis Servicesè¡¨æ ¼é¡¹ç›®ï¼Œä¸å«HLLè¾…åŠ©åˆ—
- 1ä¸ªVisual Studio Analysis Servicesè¡¨æ ¼é¡¹ç›®ï¼Œå…¶ä¸­åŒ…å«HLLè¾…åŠ©åˆ— + HLLåº¦é‡å€¼

å¯ä»¥ç‚¹å‡»[æ­¤å¤„](https://1drv.ms/x/s!AtDlC2rep7a-yGLd-z73QAHREB6h?e=pZrNQW)ä¸‹è½½åŒ…å«è¯¦ç»†ç»“æœçš„excelæ–‡ä»¶

ä¸ºäº†å»ºç«‹ä¸€ä¸ªç”¨äºå¯¹æ¯”çš„åŸºå‡†çº¿ï¼Œæˆ‘åœ¨æ²¡æœ‰HLLè¾…åŠ©åˆ—çš„æ¨¡å‹ä¸Šè¿è¡Œäº†ä¸‰æ¬¡æŸ¥è¯¢ï¼ˆå¦‚ä¸‹ï¼‰ã€‚ç„¶åï¼Œå¯¹äºHLLç®—æ³•è¿›è¡Œæµ‹è¯•ï¼Œä½¿ç”¨DISTINCTCOUNTå‡½æ•°ç¼–å†™äº†äº”ä¸ªDAXæŸ¥è¯¢è¡¨è¾¾å¼ï¼Œä»ä¸Šé¢è°ƒç”¨"Approx Distinct Users"åº¦é‡å€¼ï¼Œå¹¶åœ¨æ›´æ–°çš„æ¨¡å‹ä¸Šè¿è¡ŒHLLã€‚å¦åˆ™ï¼ŒåŸºå‡†çº¿å’Œæµ‹è¯•ç»“æœä¹‹é—´çš„åˆ†ç»„å’Œç­›é€‰æŒ‡ä»¤ä¼šç›¸åŒã€‚

ä¸€æ—¦æŸ¥è¯¢è¢«æ›´æ–°å¹¶æŒ‡å‘å¢å¼ºçš„æ¨¡å‹ï¼Œæ¯ä¸ªæŸ¥è¯¢å°†å†æ¬¡è¿è¡Œä¸‰æ¬¡ã€‚

#### æŸ¥è¯¢ 1

>```Python
// QUERY 1 - ä»…æŒ‰å¹´åˆ†ç»„.
EVALUATE 
    SUMMARIZECOLUMNS(
        // GROUP BY 
        'Date'[FirstDateofYear] , 
        // COLUMNS
        "Distinct Count" , DISTINCTCOUNT(MyEvents[UserID])
    )
>```

#### æŸ¥è¯¢ 2

>```Python
// QUERY 2 - æŒ‰2019å¹´çš„æœˆä»½åˆ†ç»„
EVALUATE 
    SUMMARIZECOLUMNS(
        // GROUP BY 
        'Date'[FirstDateofMonth] , 
        // FILTER BY 
        TREATAS({DATE(2019,1,1)},'Date'[FirstDateofYear]) , 
        // COLUMNS
        "Distinct Count" , DISTINCTCOUNT(MyEvents[UserID])
    )
>```

#### æŸ¥è¯¢ 3

>```Python
// QUERY 3 - æŒ‰2019å¹´6æœˆçš„æ—¥æœŸåˆ†ç»„
EVALUATE 
    SUMMARIZECOLUMNS(
        // GROUP BY 
        'Date'[DateKey] , 
        // FILTER BY 
        TREATAS({DATE(2019,6,1)},'Date'[FirstDateOfMonth]) , 
        // COLUMNS
        "Distinct Count" , DISTINCTCOUNT(MyEvents[UserID])
    )
>```

#### æŸ¥è¯¢ 4

>```Python
// QUERY 4 - æŒ‰2019å¹´6æœˆçš„æ—¥æœŸåˆ†ç»„, å¹¶ç”¨OperatingSystemè¿‡æ»¤
EVALUATE 
    SUMMARIZECOLUMNS(
        // GROUP BY 
        'Date'[DateKey] ,                 
        // FILTER BY 
        TREATAS({DATE(2019,6,1)},'Date'[FirstDateOfMonth]) ,
        TREATAS({"Android"},OperatingSystem[OperatingSystemName]) , 
        // COLUMNS
        "Distinct Count" , DISTINCTCOUNT(MyEvents[UserID])
    )
>```

#### æŸ¥è¯¢ 5

>```Python
//QUERY 5 - æŒ‰2019å¹´6æœˆçš„æ—¥æœŸåˆ†ç»„, å¹¶ç”¨OperatingSystemåŠDeviceè¿‡æ»¤
EVALUATE 
    SUMMARIZECOLUMNS(
        // GROUP BY 
        'Date'[DateKey] ,
        OperatingSystem[OperatingSystemName],
        Device[DeviceName],         
        // FILTER BY 
        TREATAS({DATE(2019,6,1)},'Date'[FirstDateOfMonth]) , 
        // COLUMNS
        "Distinct Count" , DISTINCTCOUNT(MyEvents[UserID])
    )
>```

#### æŸ¥è¯¢ 1 ç»“æœåˆ†æ

ç¬¬ä¸€ä¸ªæŸ¥è¯¢æŒ‰å¹´å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚ æ­¤æŸ¥è¯¢äº§ç”Ÿäº†ä¸‰è¡Œï¼Œæ‰€æœ‰ç»“æœçš„å·®å¼‚åº¦å‡åœ¨+/- 1ï¼…å†…ï¼Œå…¶ä¸­åº•éƒ¨ä¸¤è¡Œçš„å·®å¼‚åº¦åœ¨0.4ï¼…ä»¥å†…ğŸ™‚

![æŸ¥è¯¢1ç»“æœç²¾ç¡®åº¦](https://img-blog.csdnimg.cn/20191226192327372.png)

ä¸‹è¡¨æ˜¾ç¤ºäº†æ ‡å‡†DISTINCTCOUNTå‡½æ•°å’ŒHLLç‰ˆæœ¬ä¹‹é—´çš„æŸ¥è¯¢è€—æ—¶æ¯”è¾ƒã€‚å‰ä¸‰è¡Œæ˜¾ç¤ºåŸºå‡†çº¿åº¦é‡çš„è€—æ—¶ï¼Œåä¸‰è¡Œæ˜¾ç¤ºä½¿ç”¨HLLåº¦é‡çš„è€—æ—¶ã€‚

æ‰€æœ‰è®¡æ—¶å€¼å‡ä¸ºæ¯«ç§’ï¼Œä¸‰æ¬¡HLLç‰ˆæœ¬çš„æŸ¥è¯¢éƒ½åœ¨7ç§’å†…å®Œæˆï¼Œè€ŒåŸºå‡†çº¿ä¸º171ç§’ï¼Œæ‰€æœ‰å…¶ä»–å…³é”®æŒ‡æ ‡ä¹Ÿéƒ½è¦å¿«å¾—å¤šã€‚

*ï¼ˆè¯‘æ³¨ï¼šåŸºå‡†çº¿ç‰ˆæœ¬ï¼Œå³æœªä½¿ç”¨HLLç®—æ³•çš„æ–¹æ³•ï¼‰*

![æŸ¥è¯¢1--HLLä¸åŸºå‡†çº¿--æ¯«ç§’](https://img-blog.csdnimg.cn/20191226213330186.png)


#### æŸ¥è¯¢ 2 ç»“æœåˆ†æ

æŸ¥è¯¢2ä¸º2019å¹´çš„æ¯ä¸ªæœˆç”Ÿæˆä¸€è¡Œï¼ŒåŒæ ·ï¼ŒHLLè¿‘ä¼¼å”¯ä¸€å€¼è®¡æ•°åˆ—ä¸­çš„æ‰€æœ‰9ä¸ªå€¼çš„å·®å¼‚åº¦éƒ½åœ¨+/-1%èŒƒå›´å†…ï¼Œå› æ­¤åœ¨å‡†ç¡®æ€§æ–¹é¢ä»ç„¶ç›¸å½“å¥½ã€‚

![æŸ¥è¯¢2çš„å‡†ç¡®æ€§ç»“æœ](https://img-blog.csdnimg.cn/20191226213337988.png)

åœ¨æŸ¥è¯¢é€Ÿåº¦æ–¹é¢ï¼ŒHLLç‰ˆæœ¬åœ¨æ¯æ¬¡è¿è¡Œä¸­åªéœ€10ç§’å¤šå³å®Œæˆï¼Œè€ŒåŸºå‡†çº¿ç‰ˆæœ¬æ¯æ¬¡è¿è¡Œéƒ½éœ€è¦2åˆ†é’Ÿå¤šã€‚

![æŸ¥è¯¢2çš„åŸºçº¿ä¸HLLè®¡æ—¶ï¼ˆæ¯«ç§’ï¼‰](https://img-blog.csdnimg.cn/20191226213348782.png)


#### æŸ¥è¯¢ 3 ç»“æœåˆ†æ

æŸ¥è¯¢3å‘ä¸‹é’»å–åˆ°æ˜ç»†å±‚çº§ï¼Œä»è€Œäº§ç”Ÿè¾ƒä½å±‚çº§çš„è¾“å‡ºã€‚è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æ‰€æœ‰çš„ç»“æœä»ç„¶åœ¨æ­£è´Ÿ2%ä¹‹å†…ï¼Œæœ€æ˜¾è‘—çš„å˜åŒ–æ˜¯6æœˆ17æ—¥çš„-1.75%ã€‚

![æŸ¥è¯¢3çš„å‡†ç¡®æ€§ç»“æœ](https://img-blog.csdnimg.cn/20191226213403124.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)

å¯¹äºæŸ¥è¯¢3ï¼ŒHLLç‰ˆæœ¬å¤§çº¦ä¸º7ç§’ï¼Œè€ŒåŸºå‡†çº¿ç‰ˆæœ¬å°†è¿‘1åˆ†é’Ÿï¼š

![æŸ¥è¯¢3çš„åŸºçº¿ä¸HLLè®¡æ—¶ï¼ˆæ¯«ç§’ï¼‰](https://img-blog.csdnimg.cn/20191226213411130.png)


#### æŸ¥è¯¢ 4 ç»“æœåˆ†æ

æŸ¥è¯¢4åœ¨"Operating System Name"ä¸Šæ·»åŠ äº†ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œç°åœ¨ç”Ÿæˆçš„å€¼å¤§çº¦ä¸º100ä¸‡é©¬å…‹ã€‚6æœˆ7æ—¥ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡å‘ç°ç»“æœè¶…è¿‡äº†2%ã€‚å…¶ä»–å€¼éƒ½æ­£å¸¸ã€‚

![æŸ¥è¯¢4çš„å‡†ç¡®æ€§ç»“æœ](https://img-blog.csdnimg.cn/20191226213418932.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)

æŸ¥è¯¢4ä¸ºåŸºå‡†çº¿ç‰ˆæœ¬å’ŒHLLç‰ˆæœ¬ç”Ÿæˆäº†æœ€çŸ­çš„è€—æ—¶ï¼Œå…¶ä¸­HLLç‰ˆæœ¬å¤§çº¦å¿«äº†3å€ã€‚

![æŸ¥è¯¢4çš„åŸºçº¿ä¸HLLè®¡æ—¶ï¼ˆæ¯«ç§’ï¼‰](https://img-blog.csdnimg.cn/20191226213425711.png)

#### æŸ¥è¯¢ 5 ç»“æœåˆ†æ

æœ€åçš„æŸ¥è¯¢åœ¨å‡†ç¡®æ€§æ–¹é¢äº§ç”Ÿäº†ä¸€äº›æœ‰è¶£çš„ç»“æœã€‚é¢å¤–çš„åˆ†ç»„/å‘ä¸‹é’»å–ç¬¬ä¸€æ¬¡äº§ç”Ÿè¾ƒå°çš„å€¼ï¼Œè€ŒåŸºæœ¬çš„HLLç®—æ³•åœ¨è¿™äº›æƒ…å†µä¸‹å¹¶ä¸èƒ½æä¾›æœ‰ç”¨çš„ä¼°è®¡ã€‚

æŸ¥è¯¢5ç”Ÿæˆå¤§çº¦650è¡Œï¼Œæœ‰äº›å€¼éå¸¸å°ã€‚å¯¹äºè¿™äº›å€¼ï¼Œè¯¯å·®ç™¾åˆ†æ¯”ä¼šæ˜¾è‘—è¶…å‡ºä¸‹è¡¨æ‰€ç¤ºçš„æ­£è´Ÿ2%ã€‚yè½´æ˜¯ç»è¿‡å¯¹æ•°å˜æ¢çš„ï¼Œä½ å¯ä»¥çœ‹åˆ°å½“DISTINCTCOUNTå€¼ä½äº20000æ—¶ï¼Œé”™è¯¯ç‡è¿…é€Ÿä¸Šå‡ã€‚

åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå½“åŸºå‡†çº¿äº§ç”Ÿä¸€ä¸ªä¸º1çš„å€¼æ—¶ï¼ŒHLLä»£ç å¯èƒ½äº§ç”Ÿçº¦3.87äº¿çš„ä¼°è®¡å€¼ã€‚åŸå› æ˜¯æˆ‘ä»¬åœ¨ä¸€ä¸ªæ•£åˆ—æ¡¶ä¸­åªæœ‰ä¸€ä¸ªå€¼ã€‚æˆ‘ä»¬ä½¿ç”¨äº†14ä½çš„ç²¾åº¦ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æœ‰16383ä¸ªç©ºæ¡¶ã€‚

![æŒ‰ä¸åŒè®¡æ•°åˆ—å‡åºæ’åºçš„æŸ¥è¯¢5çš„ç²¾åº¦ç»“æœç¤ºä¾‹](https://img-blog.csdnimg.cn/20191226213432684.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)


![æŸ¥è¯¢5çš„ç²¾åº¦ç»“æœ](https://img-blog.csdnimg.cn/20191226213433414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)

å¹¸è¿çš„æ˜¯ï¼Œå½“æ•£åˆ—æ¡¶ç¨€ç–æ—¶ï¼Œä½¿ç”¨[LinearCounting](http://dblab.kaist.ac.kr/Prof/pdf/ACM90_TODS_v15n2.pdf)å¯ä»¥è§£å†³å”¯ä¸€å€¼ä½äº20000æ—¶çš„è¾ƒé«˜é”™è¯¯ç‡ã€‚æˆ‘å¾ˆå¿«ä¼šåœ¨åšå®¢ä¸­ä»‹ç»LinearCountingã€‚LinearCountingç®—æ³•å¯ä»¥ä½¿ç”¨ç›¸åŒçš„HLLè¾…åŠ©åˆ—åˆ—ï¼Œä½†åœ¨å¤§å‹æ•°æ®é›†ä¸­å­˜åœ¨å°‘é‡å”¯ä¸€å€¼æ—¶ï¼Œä¼šå¯¹ç©ºå­˜å‚¨æ¡¶çš„æ•°é‡è¿›è¡Œè®¡æ•°ï¼Œä»¥ä¾¿å¿«é€Ÿå¾—å‡ºå‡†ç¡®çš„ä¼°è®¡å€¼ã€‚

åœ¨æŸ¥è¯¢é€Ÿåº¦æ–¹é¢ï¼ŒHLLçš„æŸ¥è¯¢ç»“æœç•¥ä¼˜äºï¼ˆåŸºå‡†çº¿çš„ï¼‰2å€çš„æ€§èƒ½ï¼Œå› æ­¤æ€§èƒ½ä»ç„¶æ˜¯æ›´å¥½çš„ï¼Œä½†æ˜¯åœ¨è¿™æ ·çš„æŸ¥è¯¢ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘åœ¨ä»£ç ä¸­æ·»åŠ LinearCountingçš„æ€§èƒ½å¼€é”€ã€‚

![æŸ¥è¯¢4--HLLä¸åŸºå‡†çº¿--æ¯«ç§’](https://img-blog.csdnimg.cn/20191226213450130.png)

## æ€»ç»“

æ€»ä¹‹ï¼Œæˆ‘åœ¨è¿™é‡Œæè¿°çš„æ–¹æ³•ä¸ºä½¿ç”¨äº†å”¯ä¸€å€¼è®¡æ•°æŸ¥è¯¢ä¸”è¿è¡Œç¼“æ…¢çš„å¤§å‹æ¨¡å‹æä¾›äº†ä¸€ä¸ªæœ‰è¶£çš„é€‰æ‹©ã€‚è¯¥æŠ€æœ¯ç›¸å½“å®¹æ˜“åº”ç”¨ï¼Œè€Œä¸”ä¸€å¦‚æ—¢å¾€ï¼Œæ‚¨åº”è¯¥åœ¨åŸºå‡†æµ‹è¯•ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œï¼Œä»¥ä¾¿äºç¡®å®šæ˜¯å¦åº”è¯¥æœ€ç»ˆä½¿ç”¨å®ƒã€‚

>**æ•°æ®é›†è¶Šå¤§ï¼Œç®—æ³•çš„æ€§èƒ½å°±è¶Šå¥½ï¼Œç‰¹åˆ«æ˜¯å½“å”¯ä¸€å€¼çš„æ•°é‡å¢åŠ æ—¶ã€‚**

æ½œåœ¨çš„ä¼˜åŠ¿ä¸ä»…åœ¨äºæ›´å¿«çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œè¿˜åœ¨äºèƒ½å¤Ÿå¤§å¤§å‡å°‘æ‰˜ç®¡æ¨¡å‹çš„æœåŠ¡å™¨ä¸Šçš„èµ„æºæ¶ˆè€—ã€‚è¿™ä¸€å¥½å¤„åœ¨å¤šç”¨æˆ·åœºæ™¯ä¸­å¾—åˆ°äº†æ”¾å¤§ã€‚åœ¨æµ‹è¯•æ—¶ï¼Œæˆ‘æ³¨æ„åˆ°åœ¨å•ç”¨æˆ·æ¨¡å¼ä¸‹è¿è¡ŒDISTINCTCOUNTå‡½æ•°æ—¶ï¼Œè¯¥æ¨¡å‹å°†æ¶ˆè€—åƒå…†å­—èŠ‚çš„å†…å­˜ã€‚HLLç‰ˆæœ¬æ ¹æœ¬æ²¡æœ‰å¢åŠ å†…å­˜ã€‚å½“ç„¶ï¼ŒHLLç‰ˆæœ¬ä¸ºæ¨¡å‹ä½¿ç”¨äº†æ›´å¤šçš„åŸºæœ¬å†…å­˜ï¼Œä½†æ˜¯æ‚¨ä¸ä¼šé‡åˆ°æ¯ä¸ªæŸ¥è¯¢æœ€å¤šxä½ç”¨æˆ·çš„æƒ…å†µï¼Œè¿™å¯èƒ½ä¼šä½¿æœåŠ¡å™¨é¥±å’Œã€‚

æˆ‘ä¹Ÿå–œæ¬¢è¯¥ç®—æ³•å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œè°ƒæ•´çš„äº‹å®ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨çš„åˆå§‹HLLæµ‹è¯•ç»“æœä¸ä»¤äººæ»¡æ„ï¼Œè¯·çœ‹çœ‹å¯ä»¥è¿›è¡Œå“ªäº›è°ƒæ•´ã€‚ è¯¸å¦‚VertiPaqåˆ—ç¼–ç ï¼Œæ®µå¤§å°ä¹‹ç±»çš„å…¶ä»–è°ƒæ•´ä¹Ÿå¯èƒ½æä¾›ä»¤äººæ»¡æ„çš„ç»“æœã€‚

è¯¥æ–¹æ³•å¯ä»¥åº”ç”¨äºå…¶ä»–æ•°æ®å»ºæ¨¡ç¯å¢ƒã€‚ DAXè®¡ç®—çš„MDXç‰ˆæœ¬å¯ç”¨äºä½¿ç”¨ç›¸åŒçš„HLLè¾…åŠ©åˆ—åœ¨SSAS-å¤šç»´æ¨¡å‹ä¸­ç”Ÿæˆç±»ä¼¼å†…å®¹ã€‚

*ï¼ˆè¯‘æ³¨ï¼šDAXè®¡ç®—çš„MDXç‰ˆæœ¬ï¼Œæ„ä¸ºä¸Šæ–‡ç”¨åˆ°çš„DAXåœ¨MDXä¸Šçš„ç­‰ä»·å†™æ³•ï¼‰*

è¯¥æŠ€æœ¯çš„ä¸»è¦ç¼ºç‚¹æ˜¯é€šè¿‡å­˜å‚¨HLLè¾…åŠ©åˆ—å¢åŠ äº†æ€»ä½“æ¨¡å‹çš„è¦†ç›–èŒƒå›´ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†ä¸¤ä¸ªHLLè¾…åŠ©åˆ—çš„å­˜åœ¨ä¸ºæˆ‘çš„æµ‹è¯•æ¨¡å‹äº§ç”Ÿçš„é¢å¤–å†…å­˜é‡ï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20191226223808644.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_d3d3LmQtYmkudGVjaA==,size_16,color_FFFFFF,t_70)

å¯¹äºç”¨äºäº§ç”Ÿè¾ƒå°å€¼çš„HLLç‰ˆæœ¬çš„æ½œåŠ›ï¼Œæˆ‘å°†åœ¨ä»¥åçš„åšå®¢ï¼ˆLinearCountingå’Œåå·®ç®¡ç†ï¼‰ä¸­ä»‹ç»DAXè®¡ç®—çš„å¢å¼ºåŠŸèƒ½ã€‚

## å¼•ç”¨æ–‡ç« 

- http://dblab.kaist.ac.kr/Publication/pdf/ACM90_TODS_v15n2.pdf
- https://www.rose-hulman.edu/~holden/Preprints/jha-paper.pdf
- https://www.dummies.com/programming/big-data/find-number-elements-data-stream/
- https://engineering.fb.com/data-infrastructure/hyperloglog/
- https://research.neustar.biz/2013/01/24/hyperloglog-googles-take-on-engineering-hll/
- https://odino.org/my-favorite-data-structure-hyperloglog/
- http://dblab.kaist.ac.kr/Prof/pdf/ACM90_TODS_v15n2.pdf
- https://www.cs.princeton.edu/~rs/talks/AC11-Cardinality.pdf
- http://algo.inria.fr/flajolet/Publications/FlFuGaMe07.pdf
- https://www.cms.waikato.ac.nz/~abifet/book/chapter_4.html
- https://docs.google.com/document/d/1gyjfMHy43U9OWBXxfaeG-3MjGzejW1dlpyMwEYAAWEI/view?fullscreen
- https://en.wikipedia.org/wiki/HyperLogLog